---
title: æŠ€æœ¯é¢ä¹‹äº”Vue3
categories: 2023å‰ç«¯é¢è¯•æ¢³ç†
tags: é¢è¯•é¢˜
date: 2023-04-13 09:48:00
---

## vue3å“åº”å¼ç›¸è¾ƒäºvue2å…·ä½“å“ªäº›å˜åŒ–
1.æ•°æ®æ‹¦æˆªObject.definePropertyæ”¹å˜äº†Proxy + Object.definePropertyçš„æ‹¦æˆªæ–¹å¼ï¼Œå…¶ä¸­
* ref:ä½¿ç”¨Object.defineProperty + Proxy æ–¹å¼
* reactive: ä½¿ç”¨Proxy

2.åˆ›å»ºå“åº”å¼æ•°æ®çš„åœ¨è¯­æ³•å±‚é¢æœ‰äº†æ”¹å˜ï¼š
* Vue2ï¼šé€šè¿‡Dataæ¥åˆ›å»ºå“åº”å¼æ•°æ®
* Vue3ï¼šé€šè¿‡refï¼Œreactiveç­‰æ–¹å¼æ¥åˆ›å»ºå“åº”å¼æ•°æ®

3.ä¾èµ–æ”¶é›†ä¸Šé¢çš„æ”¹å˜
* Vue2ï¼šWatcher + Dep
* Vue3: weackMap + Map + Set
* è¿™ç§å®ç°æ–¹å¼å¯ä»¥å®ç°æ›´åŠ ç»†ç²’åº¦çš„ä¾èµ–è¿½è¸ªå’Œæ›´æ–°æ§åˆ¶ 

## nextTikckå®ç°åŸç†
### å‰ç»æ —å­
```bash
<template>
    <div>
        <div id="counterRef">è®¡æ•°ï¼š{{count}}</div>
        <button @click="increment">å¢åŠ æŠ€æœ¯</button>
    </div>
</template>
<script setup>
import { ref } from 'vue'
const count = ref(0)
const increment = () => {
    for(let i = 1; i <= 1000; i++) {
        count.value = i
    }
}
</script>
```
æ€è€ƒğŸ¤”ï¼šç‚¹å‡»æŒ‰é’®åï¼Œé¡µé¢ä¼šæ¸²æŸ“å‡ æ¬¡?
ç­”æ¡ˆï¼šåªä¼šæ¸²æŸ“ä¸€æ¬¡ï¼ŒåŒæ­¥ä»£ç ä¸­å¤šæ¬¡ç›¸åº”å¼æ•°æ®åšäº†ä¿®æ”¹ï¼Œå¤šæ¬¡ä¿®æ”¹è¢«æ¯**åˆå¹¶**ä¸ºä¸€æ¬¡ï¼Œä¹‹åæ ¹æ®æœ€ç»ˆçš„ä¿®æ”¹ç»“æœ**å¼‚æ­¥**çš„å»æ›´æ–°DOMã€‚

æ€è€ƒğŸ¤”ï¼šå€˜è‹¥ä¸åˆå¹¶ï¼Œå¹¶ä¸”åŒæ­¥çš„å»ä¿®æ”¹DOMï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ
ç­”æ¡ˆï¼šæ•°æ®ä¸€å˜å°±åŒæ­¥æ›´æ–°DOMï¼Œä¼šå¯¼è‡´é¢‘ç¹çš„é‡æ’é‡ç»˜ï¼Œéå¸¸æŸè€—æ€§èƒ½

æ€è€ƒğŸ¤”ï¼šå¼‚æ­¥æ›´æ–°ä¼šå¸¦æ¥çš„é—®é¢˜ï¼Ÿ
ç­”æ¡ˆï¼šæ— æ³•åŠæ—¶è·å–åˆ°æ›´æ–°åçš„DOMå€¼
åŸå› ï¼šå› ä¸ºè·å–çš„DOMæ•°æ®æ˜¯åŒæ­¥ä»£ç ï¼ŒDOMçš„æ›´æ–°æ˜¯å¼‚æ­¥ä»£ç ï¼ŒåŒæ­¥ä»£ç ä¼šç°ä¼˜å…ˆäºå¼‚æ­¥ä»£ç 
è§£å†³æ–¹æ¡ˆï¼šå°†è·å–çš„DOMæ•°æ®çš„åŒæ­¥ä»»åŠ¡åŒ…è£…æˆä¸€ä¸ªå¾®ä»»åŠ¡ï¼Œæµè§ˆå™¨åœ¨å®Œæˆä¸€æ¬¡æ¸²æŸ“åï¼Œå°±ä¼šç«‹å³æ‰§è¡Œå¾®ä»»åŠ¡
**å½“å‰æˆ‘ä»¬è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ**
```bash
const increment = () => {
    # æ¯”å¦‚å½“å‰æœ€æ–°æ•°æ®æ˜¯ 2
    count.vlaue++
    console.log('åŒæ­¥é€šè¿‡Domæ‹¿textContentæ•°æ®ï¼š'ï¼Œ coutnerRef.value.textContent) // 1
    Promise.resolve().then(() => {
        console.log('æœ€æ–°çš„æ•°æ®ï¼š', count.value) // 2
        console.log('å¼‚æ­¥é€šè¿‡Domæ‹¿textContentæ•°æ®ï¼š'ï¼Œ coutnerRef.value.textContent) // 2
    })
}
```

**nextTickå¸®æˆ‘ä»¬åšäº†å°±æ˜¯ä¸Šé¢çš„äº‹æƒ…ï¼Œå°†ä¸€ä¸ªä»»åŠ¡åŒ…è£…æˆä¸€ä¸ªå¾®ä»»åŠ¡**
nextTick è¿”å›çš„æ˜¯ä¸€ä¸ªPromise
```bash
const increment = () => {
    # æ¯”å¦‚å½“å‰æœ€æ–°æ•°æ®æ˜¯ 2
    count.vlaue++
    console.log('åŒæ­¥é€šè¿‡Domæ‹¿textContentæ•°æ®ï¼š'ï¼Œ coutnerRef.value.textContent) // 1
    nextTick(() => {
        console.log('æœ€æ–°çš„æ•°æ®ï¼š', count.value) // 2
        console.log('å¼‚æ­¥é€šè¿‡Domæ‹¿textContentæ•°æ®ï¼š'ï¼Œ coutnerRef.value.textContent) // 2
    })
    # æˆ–è€…ä¸‹é¢å†™æ³•
    await nextTick()
    console.log('æœ€æ–°çš„æ•°æ®ï¼š', count.value) // 2
    console.log('å¼‚æ­¥é€šè¿‡Domæ‹¿textContentæ•°æ®ï¼š'ï¼Œ coutnerRef.value.textContent) // 2
}
```