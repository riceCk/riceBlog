---
title: 1.uni-app基础
categories: uni-app
tags: uni-app
date: 2020-11-10 21:44:59
---
# 搭建uni-app项目
## 1.通过HBuilder X 编辑器搭建
HBuilder X 专门为uni-app开发的编辑器，通过编辑器创建项目

## 2.命令行
```bash
vue create -p dcloudio/uni-preset-vue test-uniapp
```

# 生命周期
## 1.应用生命周期
* onLaunch
应用初始化完成触发一次，全局只触发一次
* onShow
应用启动的时候，或者从后台进入前台会触发
* onHide
应用从前台进入后台触发

## 2.页面生命周期
* onLoad 
监听页面加载

* onReady
监听页面的初始化渲染完成，
TODO 如果渲染速度过快，会在页面进行动画完成前触发

* onShow
监听页面显示

* onHide
监听页面隐藏

* onUnload
监听页面卸载

## 3.组件生命周期
* beforeCreate
在实例初始化之后，数据观测（data observer）和 event/watcher 事件配置之前被调用

* created
实例创建完成之后立即调用，挂载阶段还没开始

* mounted 
挂载到实例之后调用

* destroyed
Vue 实例销毁之后调用

# 目录结构
* 1.components - 自定义组件的目录
* 2.pages - 页面存放目录
* 3.static - 静态文件资源目录
* 4.unpackage - 编译后的文件存放目录
* 5.utils - 公用的工具类
* 6.common - 公用的文件
* 7.app.vue - app.js
* 8.main.js - 应用入口
* 9.manifest.json 项目配置
* 10.page.json 

# 云数据处理
## 1.uniCloud 请求数据
### uniCloud.callFunction 类似ajax请求
```bash
uniCloud.callFunction({
	name: "get_list",
	data: {
		name: 'ck',
	},
	success (res) {
		console.log(res)
	},
	fail () {}
})
```
### uni.chooseImage 图片上传
```bash
let self = this
uni.chooseImage({
	count: 1,
	success (res) {
		const tempFilePath = res.tempFilePaths[0]
		console.log(res, '获取图片信息')
		uniCloud.uploadFile({
			cloudPath: 'a.jpg',
			filePath: tempFilePath,
			success (res) {
				console.log(res, '上传成功的回调')
				self.srcUrl = res.fileID
			},
			fail (err) {
				console.log(err, '上传失败的回调')
			}
		})
	},
	fail (err) {
		console.log(err)
	}
})
```
### uniCloud.deleteFile 图片/文件的删除
```bash
uniCloud.deleteFile({
	fileList: ['https://vkceyugu.cdn.bspapp.com/VKCEYUGU-aliyun-ri0elnlfgwuu420521/4ab0a1b7-2a8f-4483-9eaf-738199413017.jpg'],
	success(res) {
		console.log(res)
	},
	fail(err) {
		console.log(err)
	}
})
```
## 2.云数据的添加和删除
cloudfunctions > get_list > index.js
### 单条数据的添加
```bash
'use strict';
#  处理数据库 > 1
const db = uniCloud.database();
#  运行在云端（服务端)的函数
exports.main = async (event, context) => {
	#  处理数据库 > 2
	const collection = db.collection('user')
	#  新增数据库 > 3
	let res = await collection.add({
		name: 'uni-app'
	})
	console.log("数据插入： ", JSON.stringify(res));
	# event为客户端上传的参数
	#  context 包含了调用信息和运行状态，获取每次调用的上下文
	console.log('event : ', event)
	# 返回数据给客户端
	return {
		code: 200,
		msg: event,
	}
};
```

### 多条数据的添加
```bash
'use strict';
#  处理数据库 > 1
const db = uniCloud.database();
# 运行在云端（服务端)的函数
exports.main = async (event, context) => {
	# 处理数据库 > 2
	const collection = db.collection('user')
	# 新增数据库 > 3
	let res = await collection.add([
		{
			name: 'vue'
		},
		{
			name: 'html',
      type: "前端"
		},
	])
	console.log("数据插入： ", JSON.stringify(res));
	return {}
};
```

### 删除指定数据 doc
```bash
'use strict';
#  处理数据库 > 1
const db = uniCloud.database();
#  运行在云端（服务端)的函数
exports.main = async (event, context) => {
	#  处理数据库 > 2
	const collection = db.collection('user')
  # 删除数据
	collection.doc("5fd8b8a07574ed0001a21bbc").remove()
	# 返回数据给客户端
	return {}
};
```

### 数据更新 update 方法
**update** 只能更新存在的记录
**set** 如果记录存在就更新，如果不存在就添加
```bash
'use strict';
# 处理数据库 > 1
const db = uniCloud.database();
# 运行在云端（服务端)的函数
exports.main = async (event, context) => {
	# 处理数据库 > 2
	const collection = db.collection('user')
	const res = await collection.doc("5fd8b8a07574ed0001a21bbb").update({
		name: "html"
	})
	console.log('数据更新', JSON.stringify(res))
	# 回数据给客户端
	return {}
};
```


### 数据更新 set 方法
**update** 只能更新存在的记录
**set** 如果记录存在就更新，如果不存在就添加

```bash
'use strict';
# 处理数据库 > 1
const db = uniCloud.database();
# 运行在云端（服务端)的函数
exports.main = async (event, context) => {
	# 处理数据库 > 2
	const collection = db.collection('user')
	const res = await collection.doc("234234").update({
		name: "html",
    type: "前端"
	})
	console.log('数据更新', JSON.stringify(res))
	# 回数据给客户端
	return {}
};
```

### 查找数据 get
```bash
'use strict';
# 处理数据库 > 1
const db = uniCloud.database();
# 运行在云端（服务端)的函数
exports.main = async (event, context) => {
	# 处理数据库 > 2
	const collection = db.collection('user')
	const res = await collection.doc("5fd8b8a07574ed0001a21bbb").get()
	console.log('查找', res)
	return {}
};
```