---
title: 3.Python控制结构、函数与代码复用
categories: python
tags: python
date: 2020-06-16 19:36:00
---

# 程序的分支结构
## 分支结构
```bash
if
if-else
if-elif-else 
```
## 浮点数的比较
```bash
0.2 == 0.2 # True
0.3 == 0.1 + 0.2 # False

a = 0.1 + 0.2
abs(a - 0.3) < 0.00001 # True
math.isclose(a, 0.3) # True
```
## not,or,and
```bash
a = true
not a # False
not not a # True 

b1 = True
b2 = False
b1 or b2 # True
b3 = False
b2 or b3 # False

b1 and b2 # False
b4 = True
b1 and b4 # True 
```

## 分支结构单行表达式
二分支结构还有一种更简洁表达式，适合通过判断返回特定的值，语法格式如下：
<表达式1> if <条件> else <表达式2>
```bash
Temp = eval(input("请输入你的体温："))
print("体温{}异常！".format("存在"if Temp >= 37.2 else "没有"))
```
## 多分支结构：if-elif-else语言
```bash
BMI = eval(input("请输入你的BMI数值："))
if 0 <= BMI < 15:
    print("你太瘦了")
elif 15 <= BMI < 25:
    print("你的身材很好了")
else:
    print("你有点超重了，J减减肥")
```
# 程序的循环机构
## range函数
range()是一个计数函数，实现循环从一个数字开始计数到另一个数字，一旦达到最后一个数字或者某一个条件不在满足就立刻退出循环：
```bash
list(range(1, 10, 1)) 
list(range(1, 10)) 
list(range(10)) 
# [1, 2, 3, 4, 5, 6, 7, 8, 9]

list(range(1, 10, 2))
# [1, 3, 5, 7, 9]

list(range(1, 10, 3))
# [1, 4, 7]
```

## enumerate枚举函数
```bash
names = ["a", "b", "c"]
for index, name in enumerate(names):
    print("%d %s"%(index, name))
# 0 a
# 1 b
# 2 c
```

## zip函数
zip函数接受任意多个（包括0个和1个）序列作为参数，返回一个tuple列表
```bash
names = ["a", "b", "c"]
ages = [15, 16, 14]
for name, age in zip(names, ages):
    print("%s %d"%(name, age))
# a 15
# b 16
# c 14
```

## reversed 函数
```bash
list(reversed(range(10)))
# [9, 8, 7, 6, 5, 4, 3, 2, 1, 0]

for i in reversed(range(10)):
    print(i)
```
## for..in
```bash
for c in 'sky':
    print("循环进行中: "+ c)
else: 
    c = "循环正常结束"
print(c)
```
## while循环
while循环：
while循环一直保持循环操作指导特定循环条件不被满足才结束，不需要提前知道确定循环次数
```bash
s, index = "sky", 0
while index < len(s):
    print("循环进行中" + s[index])
    index += 1
else:
    s = "这句话输出是不满足while条件"
print(s)
```
## 循环保留字：break和continue
- 循环结构有两个辅助保留字：break和continue，它们用来辅助控制循环执行
- break用来跳出最内层for或while循环，脱离改循环后程序从循环后代吗继续执行
- continue用来结束当前当次循环，即跳出循环体中下面尚未执行的语句，当不跳出当前循环
- 对于while循环，继续求解循环条件，对于for循环，程序流程接着遍历循环列表

```bash
for s in "SKY":
    for i in range(6):
        print(s, end="")
        if s=="K":
            break
# SSSSSSKYYYYYY
```
## random 库概述
rangdom库Python用于
| 函数 | 描述 |
| :---: | :---: |
|random()|生成一个[0.0, 1.0)之间的随机小数|
|randint(a, b) |生成一个[a,b]之间的整数|
|getrandbits(k) |生成一个k比特长度的随机整数|
|randrange(start, stop[, step]) |生成一个[start, stop)之间以step为步数的随机整数|
|uniform(a, b) |生成一个[a, b]之间的随机小数|
|choice(seq)|从序列类型(例如：列表)中随机返回一个元素|
|shuffle(seq)|将序列类型中元素随机排列，返回打乱后的序列|
|sample(pop, k)|从pop类型中随机选取k个元素，以列表类型返回|

# 程序的异常处理
异常处理：try-exceopt语句
```bash
try:
    num = eval(input("请输入一个整数："))
    print(num ** 2)
except NameError:
    print("输入一个错误，请输入一个整数！")
```
## 高级用法
```bash
try:
    letters = "ASDFGHJKLLLLLQWERTYUIOPZXCVBNM"
    indx = eval(input("请输入一个整数："))
    print(letters(indx))
except NameError: # 非数字走着
    print("输入一个错误，请输入一个整数！")
except: # 小数，浮点型走这
    print("其他错误")
```
## 异常的高级用法
#### 采用else和finally修改代码如下：
```bash
try:
    letters = "ASDFGHJKLLLLLQWERTYUIOPZXCVBNM"
    indx = eval(input("请输入一个整数："))
    print(letters(indx))
except NameError:
    print("输入一个错误，请输入一个整数！")
else:
    print("没有发生异常")
finally:
    print("程序执行完毕，不知道是否发生了异常")
```
### 先特殊后万能
```bash
try:
    letters = "ASDFGHJKLQWERTYUIOZXCVBNM"
    idx = eval(input("请输入一个整数："))
    print(letters[idx])
except NameError: # 异常时，执行该块
    print("请输入错误，请输入一个整数")
except IndexError: # 异常时，执行该块
    print("输入错误，请输入0-25中的一个整数！")
except Exception: # 异常时，执行该块
    print("其他错误！请重新输入")
else: # 主代码快执行完，执行该块
    print("没有发生异常")
finally: # 无论异常与否，最终执行该块
    print("程序执行完毕")
```

### 重命名报错信息
```bash
s1 = 'hello'
try: 
    int(s1)
except KeyError as ke:
    print("键错误:", ke)
except IndexError as ie:
    print("索引错误:", ie)
except Exception as e:
    print("其他错误:", e)
```

### raise主动抛出异常
```bash
try:
    s = None
    if s in None:
        print("s是空对象")
        raise NameError
    print(len(s))
except TypeError as te:
    print("类型错误：", te)
    print("空对象没有长度")
```

# 函数
## 函数定义
```bash
def happy(name):
    print("新年快乐！{}总".format(name))
happy("王")
happy("李")  
```

## 函数调用的过程
- 调用程序在调用处暂定执行；
- 在调用时将实参复制给函数的形参
- 执行函数体语句
- 函数调用结束给出返回值，程序回到调用前的暂停处继续执行

## 函数的参数
### 在定义函数时，有些参数可以存在默认值
```bash
def repeat(str, times = 2):
    print(str * times)
    
repeat('hello')
repeat("hello", 4)
```  
### 在定义函数时，有默认值的参数必须写在没有默认值的参数后面
```bash
def repeat(str, times = 2, name) # 报错
    print(str * times)
```
### 在函数定义时，可以设计可变数量参数，通过参数前增加星号（*）实现
```bash
def func(x, *y):
    print("y:", y)
    print(max(y))
    for n in y:
        x += n
    return x

func(1, 2, 3, 4)
```
在调用函数是也能够使用*语法，在这种情况下，它与函数定义的意思相反，它会解包参数的集合，而不是创建参数的集合
```bash
def func(a, b, c)
    print(a + b + c)
args = (1, 2, 3)
func(*args)
```
### 在python中，还有可以将定义好的函数作为参数传给另一个函数
```bash
def fun1(x):
    return x * x
def fun2(a, fun):
    return fun(a)
print(fun2(3, fun1))
```

## 函数返回值
- return语言用来退出函数并将程序返回到函数调用的位置继续执行
- retrun语言同时可以将0个、1个或多个函数运算完的结果返回给函数被调用的变量

```bash
import math
def move(x, y, step, angle = 0):
    nx = x + step * math.cos(angle)
    ny = y - step * math.sin(angle)
    return nx, ny
x, y = move(100, 100, 60, math.pi / 6)
print(x, y)
```
## 函数的定义嵌套
函数内部可以在定义函数，这些函数只能在函数内部使用
```bash
def fun1(x, y):
    def fun2(a):
        return a * a
    def fun3(b):
        return pow(b, 0.5)
    return fun3(fun2(x) + fun2(y))
fun1(3, 40)
```

## 全局变量和局部变量
如果希望在func()函数将x当做全局变量，需要在变量x使用前global关键字声明该变量为全局变量
```bash
x = 1
def func(a, b):
    global x
    x = a + b
    return x
func(3, 4)
x # 5
```
### 如果此时全局变量不是整数x，而是列表类型l如下
```bash
l = []
def func(x, y):
    l.append(x + y)
    return x * y
func(2, 3)
```

### 嵌套函数中的全局变量和局部变量
```bash
x = 1
def fun1():
    x = 2
    print("fun1的局部变量x：", x)
    def fun2():
        global x
        x = 3
        print("全局变量x：", x)
    fun2()
    print("fun1最后的x值：", x)
print("最开始的x值：", x)
fun1()
print("最后的x值：", x)

# 最开始的x值： 1
# fun1的局部变量x： 2
# 全局变量x： 3
# fun1最后的x值： 2
# 最后的x值： 3
```

## lambda函数
```bash
c = lambda x, y, z: x * y * z
c(2, 3, 4)
```
## map和lambda函数组合使用
```bash
def sq(x):
    return x * x
list(map(sq, [y for y in range(5)]))
# [0, 1, 4, 9, 16]
list(map(lambda x: x * x, [y for y in range(5)]))
```

# Python迭代器和生成器 
## 迭代器和生成器同一例子不同方式
普通函数
```bash
def gensquares(N):
    res = []
    for i in range(N):
        res.append(i * i)
    return res
for item in gensquares(5):
    print(item)
```
生成器
```bash
def gensquares(N):
    for i in range(N):
        yield i ** 2
for item in gensquares(5):
    print(item)
```